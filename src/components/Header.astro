---
const navLinks = [
  { label: 'Startseite', href: '/' },
  { label: 'Leistungen', href: '/leistungen' },
  { label: 'Zielgruppen', href: '#', children: [
    { label: 'Privatkunden', href: '/zielgruppen/privat' },
    { label: 'KMU', href: '/zielgruppen/kmu' },
    { label: 'Industrie', href: '/zielgruppen/industrie' },
    { label: 'Immobilienverwalter', href: '/zielgruppen/immobilienverwalter' },
  ]},
  { label: 'Transparenz', href: '/transparenz' },
  { label: 'Referenzen', href: '/referenzen' },
  { label: 'Blog', href: '/blog' },
  { label: 'Kontakt', href: '/kontakt' },
];

const currentPath = Astro.url.pathname;
---

<header class="fixed top-0 inset-x-0 z-50 transition-all duration-300" id="site-header">
  <div class="container-wide">
    <div class="flex items-center justify-between h-16 lg:h-20">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-2 group" aria-label="EnergieMakler Startseite">
        <div class="w-9 h-9 rounded-lg gradient-brand flex items-center justify-center shadow-md group-hover:shadow-lg transition-shadow">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round">
            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
          </svg>
        </div>
        <span class="font-heading font-bold text-xl text-dark-900">
          Energie<span class="text-brand-600">Makler</span>
        </span>
      </a>

      <!-- Desktop Nav -->
      <nav class="hidden lg:flex items-center gap-1" aria-label="Hauptnavigation">
        {navLinks.map((link) => (
          link.children ? (
            <div class="relative group">
              <button class={`px-3 py-2 text-sm font-medium rounded-lg transition-colors hover:bg-brand-50 hover:text-brand-700 ${currentPath.startsWith('/zielgruppen') ? 'text-brand-700 bg-brand-50' : 'text-gray-600'}`}>
                {link.label}
                <svg class="inline-block ml-1 w-3 h-3 transition-transform group-hover:rotate-180" fill="none" viewBox="0 0 10 6"><path d="M1 1l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
              </button>
              <div class="absolute top-full left-0 pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
                <div class="bg-white rounded-xl shadow-xl border border-gray-100 py-2 min-w-[220px]">
                  {link.children.map((child) => (
                    <a href={child.href} class={`block px-4 py-2.5 text-sm hover:bg-brand-50 hover:text-brand-700 transition-colors ${currentPath === child.href ? 'text-brand-700 bg-brand-50 font-medium' : 'text-gray-600'}`}>
                      {child.label}
                    </a>
                  ))}
                </div>
              </div>
            </div>
          ) : (
            <a href={link.href} class={`px-3 py-2 text-sm font-medium rounded-lg transition-colors hover:bg-brand-50 hover:text-brand-700 ${currentPath === link.href ? 'text-brand-700 bg-brand-50' : 'text-gray-600'}`}>
              {link.label}
            </a>
          )
        ))}
      </nav>

      <!-- CTA + Mobile Toggle -->
      <div class="flex items-center gap-3">
        <a href="/anfrage"
           class="hidden sm:inline-flex items-center gap-2 px-5 py-2.5 text-sm font-semibold text-white gradient-brand rounded-xl shadow-md hover:shadow-lg hover:scale-[1.02] active:scale-[0.98] transition-all duration-200">
          Jetzt anfragen
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </a>
        <button id="mobile-toggle" class="lg:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors" aria-label="Menü öffnen" aria-expanded="false">
          <svg id="icon-menu" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
            <path d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
          <svg id="icon-close" class="hidden" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="lg:hidden fixed inset-0 top-16 bg-white/95 backdrop-blur-xl z-40 translate-x-full transition-transform duration-300 ease-in-out">
    <nav class="container-wide py-6 space-y-1" aria-label="Mobile Navigation">
      {navLinks.map((link) => (
        link.children ? (
          <div>
            <p class="px-4 py-2 text-xs font-semibold text-gray-400 uppercase tracking-wider">{link.label}</p>
            {link.children.map((child) => (
              <a href={child.href} class="block px-4 py-3 text-base font-medium text-gray-700 hover:text-brand-600 hover:bg-brand-50 rounded-lg transition-colors">
                {child.label}
              </a>
            ))}
          </div>
        ) : (
          <a href={link.href} class="block px-4 py-3 text-base font-medium text-gray-700 hover:text-brand-600 hover:bg-brand-50 rounded-lg transition-colors">
            {link.label}
          </a>
        )
      ))}
      <div class="pt-4 px-4">
        <a href="/anfrage" class="flex items-center justify-center gap-2 w-full px-6 py-3.5 text-base font-semibold text-white gradient-brand rounded-xl shadow-md">
          Jetzt anfragen
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </a>
      </div>
    </nav>
  </div>
</header>

<!-- Spacer for fixed header -->
<div class="h-16 lg:h-20"></div>

<script>
  // Mobile menu toggle
  const toggle = document.getElementById('mobile-toggle');
  const menu = document.getElementById('mobile-menu');
  const iconMenu = document.getElementById('icon-menu');
  const iconClose = document.getElementById('icon-close');

  toggle?.addEventListener('click', () => {
    const isOpen = !menu?.classList.contains('translate-x-full');
    menu?.classList.toggle('translate-x-full', isOpen);
    menu?.classList.toggle('translate-x-0', !isOpen);
    iconMenu?.classList.toggle('hidden', !isOpen);
    iconClose?.classList.toggle('hidden', isOpen);
    toggle.setAttribute('aria-expanded', String(!isOpen));
    document.body.style.overflow = isOpen ? '' : 'hidden';
  });

  // Sticky header background
  const header = document.getElementById('site-header');
  const onScroll = () => {
    if (window.scrollY > 20) {
      header?.classList.add('bg-white/90', 'backdrop-blur-xl', 'shadow-sm');
    } else {
      header?.classList.remove('bg-white/90', 'backdrop-blur-xl', 'shadow-sm');
    }
  };
  window.addEventListener('scroll', onScroll, { passive: true });
  onScroll();
</script>
