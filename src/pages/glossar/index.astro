---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import ConsentBanner from '../../components/ConsentBanner.astro';
import SectionHeading from '../../components/ui/SectionHeading.astro';
import { getCollection } from 'astro:content';

const entries = (await getCollection('glossar')).sort((a, b) =>
  a.data.title.localeCompare(b.data.title, 'de')
);

// Group by letter
const grouped = entries.reduce<Record<string, typeof entries>>((acc, entry) => {
  const letter = entry.data.letter.toUpperCase();
  if (!acc[letter]) acc[letter] = [];
  acc[letter].push(entry);
  return acc;
}, {});
---

<BaseLayout
  title="Glossar – Energiebegriffe einfach erklärt | EnergieMakler"
  description="Unser Energie-Glossar erklärt die wichtigsten Begriffe rund um Strom, Gas und Energiemarkt verständlich und praxisnah."
>
  <Header slot="header" />

  <section class="section-padding">
    <div class="container-narrow">
      <SectionHeading
        title="Energie-Glossar"
        subtitle="Die wichtigsten Begriffe rund um Energie – verständlich erklärt."
      />

      <!-- Letter navigation -->
      <div class="flex flex-wrap gap-2 mb-12 justify-center">
        {Object.keys(grouped).sort().map((letter) => (
          <a href={`#letter-${letter}`} class="w-10 h-10 flex items-center justify-center rounded-lg bg-brand-50 text-brand-700 font-semibold text-sm hover:bg-brand-100 transition-colors">
            {letter}
          </a>
        ))}
      </div>

      <!-- Entries -->
      <div class="space-y-12">
        {Object.entries(grouped).sort(([a], [b]) => a.localeCompare(b)).map(([letter, items]) => (
          <div id={`letter-${letter}`}>
            <h2 class="text-3xl font-heading font-bold text-brand-600 mb-4 border-b border-brand-100 pb-2">{letter}</h2>
            <div class="space-y-3">
              {items.map((entry) => (
                <a href={`/glossar/${entry.slug}`} class="block p-4 rounded-xl hover:bg-gray-50 transition-colors group">
                  <h3 class="font-semibold text-dark-900 group-hover:text-brand-600 transition-colors">{entry.data.title}</h3>
                  <p class="text-sm text-gray-500 mt-1">{entry.data.description}</p>
                </a>
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <Footer slot="footer" />
  <ConsentBanner slot="consent" />
</BaseLayout>
